<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
		<!-- <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />-->
		<!--  <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.css" />
		<link rel="stylesheet" href="css/df.min.css" />

		<style>
			@media (min-width:35em){

				/* wrap on wide viewports once open */

				.ui-responsive-panel.ui-page-panel-open .ui-panel-content-fixed-toolbar-display-push.ui-panel-content-fixed-toolbar-position-left,
				.ui-responsive-panel.ui-page-panel-open .ui-panel-content-fixed-toolbar-display-reveal.ui-panel-content-fixed-toolbar-position-left,
				.ui-responsive-panel.ui-page-panel-open .ui-panel-content-wrap-display-push.ui-panel-content-wrap-position-left,
				.ui-responsive-panel.ui-page-panel-open .ui-panel-content-wrap-display-reveal.ui-panel-content-wrap-position-left {
					margin-right: 17em;
				}
				.ui-responsive-panel.ui-page-panel-open .ui-panel-content-fixed-toolbar-display-push.ui-panel-content-fixed-toolbar-position-right,
				.ui-responsive-panel.ui-page-panel-open .ui-panel-content-fixed-toolbar-display-reveal.ui-panel-content-fixed-toolbar-position-right,
				.ui-responsive-panel.ui-page-panel-open .ui-panel-content-wrap-display-push.ui-panel-content-wrap-position-right,
				.ui-responsive-panel.ui-page-panel-open .ui-panel-content-wrap-display-reveal.ui-panel-content-wrap-position-right {
					margin-left: 17em;
				}
				.ui-responsive-panel.ui-page-panel-open .ui-panel-content-fixed-toolbar-display-push,
				.ui-responsive-panel.ui-page-panel-open .ui-panel-content-fixed-toolbar-display-reveal {
					width: auto;
				}

				/* disable "dismiss" on wide viewports */
				.ui-responsive-panel .ui-panel-dismiss-display-push {
					display: none;
				}

			}

		</style>
        <title>Dreamfactory Cards</title>
    </head>
    <body>
		<div data-role="page" class="ui-responsive-panel">		
			<div data-role="header" data-position="fixed" role="banner">
				<h2 role="heading" id="contentTitle">kaart x</h2>
				<a href="#cards" class="jqm-navmenu-link ui-nodisc-icon ui-alt-icon ui-btn-left ui-btn ui-icon-bars ui-btn-icon-notext ui-corner-all" data-role="button" role="button">Menu</a>
				<a href="#debug" class="jqm-navmenu-link ui-nodisc-icon ui-alt-icon ui-btn-right ui-btn ui-icon-bars ui-btn-icon-notext ui-corner-all" data-role="button" role="button">Debug</a>
				</div>
			<div role="main" class="ui-content main">
				<section class="container">
					<div class="card" id="card" data-rotateY="0">
						<figure class="cardFront"></figure>
						<figure class="cardBack"></figure>
					</div>
				</section>
			</div>
			<div data-role="footer" data-position="fixed" role="banner"><h2 role="heading">footer</h2></div>
			<div data-role="panel" data-position="left" data-display="overlay" class="cardsNavigation" id="cards">
				<ul data-role="listview">
					<li data-icon="delete"><a href="#" data-rel="close">Close navigation</a></li>
					<!--<li data-icon="false"><a href="#">Apple</a></li>
					<li data-icon="false"><a href="#">Banana</a></li>
					<li data-icon="false"><a href="#">Cherry</a></li>
					<li data-icon="false"><a href="#">Cranberry</a></li>
					<li data-icon="false"><a href="#">Grape</a></li>
					<li data-icon="false"><a href="#">Orange</a></li>-->
				</ul>

			</div>
			<div data-role="panel" data-position="right" data-display="overlay" id="debug">
				<ul data-role="listview">
					<li data-icon="delete"><a href="#" data-rel="close">Close debug</a></li>
				</ul>

			</div><!-- /panel -->
		</div>

		<script type="text/javascript" src="cordova.js"></script>
		<script type="text/javascript" src="js/jquery-2.0.3.min.js"></script>
		<!-- <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script> -->
		<script src="http://code.jquery.com/mobile/1.4.0/jquery.mobile-1.4.0.min.js"></script>
		<script>
			cards = {};
			
			console.log = function(text){
				$("#debug ul").append('<li data-icon="false"><a href="#">'+text+'</a></li>');
				//$("#debug").listview( "refresh" );
			}
			
			$(function(){
				// Bind the swipeHandler callback function to the swipe event on div.box
				$( "#card" ).on( "swipeleft swiperight", initRotate );
				
			//	$(".cardFront").css({'background-image':'url(kaarten/kaart1V.png)'});
			//	$(".cardBack").css({'background-image':'url(kaarten/kaart1A.png)'});

				$.getJSON("data/data.json",function(data){
					console.log("success loading data")
					try{
						console.log(data.kaarten.length + "cards loaded");
						cards = data.kaarten;
						setupNavigation();
					} catch(err){
						console.log("error : " + err);
					}
					//app.setupNavigation();
				})
				.fail(function() {
					console.log( "error loading data" );
				}); 

				
				// Callback function references the event target and adds the 'swipe' class to it
				function initRotate( event ){
					console.log("initRotate");
					var $card = $("#card"),
						direction = event.type === "swipeleft" ? -180 : 180;
					degrees = $card.data('rotatey') + direction;
					$card.data('rotatey', degrees);
					rotateCard(card, degrees);
				}
				function rotateCard(card, degrees){
					$(card).css({
						'-webkit-transform': 'rotateY( '+degrees+'deg )',
						'-moz-transform': 'rotateY( '+degrees+'deg )',
						'-o-transform': 'rotateY( '+degrees+'deg )',
						'transform': 'rotateY( '+degrees+'deg )'
					})
				}
				function showCard(card){
					console.log('showCard')
//					$("body").removeClass("largeScreen");
//					$(".flip-container").removeClass("hover");
					
					$(".cardFront").css({"background-image": "url("+card.imageVoor+")"});
					$(".cardBack").css({"background-image": "url("+card.imageAchter+")"});
					$("#contentTitle").html(card.titel);
					
				};

				function setupNavigation(){
					console.log('setupNavigation')
					$.each(cards, function(index, value){
						$( "<li id='"+value.naam+"' data-icon='false'><a href='#'>"+value.titel+"</a></li>" ).appendTo( "#cards ul" );
						var navigationItem = $("#"+value.naam+" a");
						navigationItem.on('click touchend', function(event){
							event.preventDefault();
							var $this = $(this);
							showCard(cards[$this.data("cardIndex")]);
						});
						navigationItem.data("cardInfo",value);
						navigationItem.data("cardIndex", index);
					});
					showCard(cards[0]);
				}
			});
		</script>
    </body>
</html>
